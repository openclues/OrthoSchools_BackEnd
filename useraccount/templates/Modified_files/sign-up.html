{% load widget_tweaks %}
{% load static %}
<!DOCTYPE html>
<html class="no-js" lang="zxx">
{% include 'parts/site_head.html' %}
<body>
    <!--[if lte IE 9]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="https://browsehappy.com/">upgrade your browser</a> to improve
        your experience and security.
      </p>
    <![endif]-->

    <!-- pre loader area start -->
        {% include 'parts/loading_part.html' %}
    <!-- pre loader area end -->

    <!-- back to top start -->
    <div class="progress-wrap">
        <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
            <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
        </svg>
    </div>
    <!-- back to top end -->

    <main>
        <!-- sign up area start -->
        <section class="signup__area p-relative z-index-1 pt-100 pb-145">
            <div class="sign__shape">
                <img class="man-1" src="{% static 'img/icon/sign/man-3.png' %}" alt="" />
                <img class="man-2 man-22" src="{% static 'img/icon/sign/man-2.png' %}" alt="" />
                <img class="circle" src="{% static 'img/icon/sign/circle.png' %}" alt="" />
                <img class="zigzag" src="{% static 'img/icon/sign/zigzag.png' %}" alt="" />
                <img class="dot" src="{% static 'img/icon/sign/dot.png' %}" alt="" />
                <img class="bg" src="{% static 'img/icon/sign/sign-up.png' %}" alt="" />
                <img class="flower" src="{% static 'img/icon/sign/flower.png' %}" alt="" />
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-xxl-8 offset-xxl-2 col-xl-8 offset-xl-2">
                        <div class="section__title-wrapper text-center mb-55">
                            <h2 class="section__title">Create an Account</h2>
                            <p>I'm a subhead that goes with a story.</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xxl-6 offset-xxl-3 col-xl-6 offset-xl-3 col-lg-8 offset-lg-2">
                        <div class="sign__wrapper white-bg">
                            <div class="sign__header d-none mb-35">
                                <div class="sign__in text-center">
                                    <a href="#" class="sign__social g-plus text-start mb-15">
                                        <i class="fab fa-google-plus-g"></i>Sign Up with Google
                                    </a>
                                    <p>
                                        <span>........</span> Or,
                                        <a href="{% static 'sign-up.html' %}">sign up</a> with your email<span>........</span>
                                    </p>
                                </div>
                            </div>
                            <div id="error-message" style="color: red;"></div>

                            <div class="sign__form">
                                <form method="post">
                                    {% csrf_token %}
                    <div class="d-flex justify-content-between">

                      <div class="sign__input-wrapper-name mb-25">
                        <h5>First Name</h5>
                       <div class="sign__input">
                                            {% render_field form.first_name type="text"  placeholder="First Name" class="sing__input" required="true"    %}
                                            <i class="fal fa-user"></i>
                                        </div>
                      </div>
                      <div class="sign__input-wrapper-name mb-25 ">
                        <h5>Last Name</h5>
                        <div class="sign__input">
                                            {% render_field form.last_name type="text" placeholder="Last Name" %}
                                            <i class="fal fa-user"></i>
                                        </div>                      </div>
                    </div>

                                    <div class="sign__input-wrapper mb-25">
                                        <h5>Email</h5>
                                        <div class="sign__input">
                                            {% render_field form.email type="email"  placeholder="e-mail address" %}
                                            <i class="fal fa-envelope"></i>
                                        </div>
                                        <div id="email-error" style="color: red;"></div>
                                    </div>

                                    <div class="sign__input-wrapper mb-25">
                                        <h5>Password</h5>
                                        <div class="sign__input">
                                            {% render_field form.password  type="password"  placeholder="Password" class="sing__input"%}
                                            <i class="fal fa-lock"></i>

                                        </div>
                                        <div id="password-error" style="color: red;"></div>
                                    </div>

                                    <div class="sign__input-wrapper mb-10">
                                        <h5>Confirm Password</h5>
                                        <div class="sign__input">
                                            {% render_field form.confirm_password type="password"  placeholder="Confirm password"%}
                                            <i class="fal fa-lock"></i>
                                        </div>
                                    </div>

                                    <div class="sign__action d-flex justify-content-between mb-30">
                                        <div class="sign__agree d-flex align-items-center">
                                            <input class="m-check-input" type="checkbox" id="m-agree" />
                                            <label class="m-check-label" for="m-agree">
                                                I agree to the <a href="#">Terms & Conditions</a>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="spinner-border" role="status" style="display: none;">
  <span class="visually-hidden">Loading...</span>
</div>

                                    <button class="tp-btn w-100"><span></span> Sign Up</button>

                                    <div class="sign__new text-center mt-20">
                                        <p>Already in Eduker ? <a href="{% static 'sign-in.html' %}"> Sign In</a></p>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- sign up area end -->
    </main>

    <!-- JS here -->

<!-- Add a div to display error messages -->
{#<div id="error-message" style="color: red;"></div>#}

<script src="{% static 'js/vendor/jquery.js' %}"></script>
<script src="{% static 'js/vendor/waypoints.js' %}"></script>
<script src="{% static 'js/bootstrap-bundle.js' %}"></script>
<script src="{% static 'js/meanmenu.js' %}"></script>
<script src="{% static 'js/swiper-bundle.js' %}"></script>
<script src="{% static 'js/owl-carousel.js' %}"></script>
<script src="{% static 'js/magnific-popup.js' %}"></script>
<script src="{% static 'js/parallax.js' %}"></script>
<script src="{% static 'js/backtotop.js' %}"></script>
<script src="{% static 'js/nice-select.js' %}"></script>
<script src="{% static 'js/counterup.js' %}"></script>
<script src="{% static 'js/wow.js' %}"></script>
<script src="{% static 'js/isotope-pkgd.js' %}"></script>
<script src="{% static 'js/imagesloaded-pkgd.js' %}"></script>
<script src="{% static 'js/ajax-form.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
<script src="{% static 'js/jquery.min.js' %}"></script>
<script>
$(document).ready(function () {
    // Intercept the form submission
    $('form').submit(function (event) {
        event.preventDefault();  // Prevent normal form submission

        // Clear previous error messages
        $('.sign__input-wrapper p').text('');
        $('#error-message').text('');
        $('#email-error').text('');
        $('#password-error').text('');

        // Check if password matches confirm password
        const password = $('[name="password"]').val();
        const confirmPassword = $('[name="confirm_password"]').val();

        if (password !== confirmPassword) {
            // Display an error message for password mismatch
            $('#password-error').text('Passwords do not match');
            return;  // Stop form submission
        }

        // Show loading spinner
        $('.spinner-border').show();

        $.ajax({
            type: 'POST',
            url: '{% url "user-create" %}',  // Replace with your URL
            data: $(this).serialize(),
            success: function (response, status, xhr) {
                if (xhr.status === 201) {
                    console.log("success");
                    // Successful signup, redirect or perform other actions
                    window.location.href = '{% url "login" %}';
                } else {
                    // Handle other errors or provide a general message
                    $('#error-message').text('Registration failed. Please check the form.');
                }
            },
            error: function (response) {
                const responseJSON = response.responseJSON;
                console.log(responseJSON);

                // Handle errors for each field
                handleFieldError(responseJSON, 'email', '#email-error');
                handleFieldError(responseJSON, 'password', '#password-error');

                // Hide loading spinner regardless of success or failure
                $('.spinner-border').hide();
            },
            complete: function () {
                // Hide loading spinner regardless of success or failure
                console.log("complete");
                $('.spinner-border').hide();
            }
        });
    });

    // Function to handle errors for each field
    function handleFieldError(responseJSON, fieldName, errorElementId) {
        if (responseJSON[fieldName] && responseJSON[fieldName].length > 0) {
            const fieldErrors = responseJSON[fieldName];
            console.log(`${fieldName} errors:`, fieldErrors);

            // Display or handle errors for the field as needed
            // Update the corresponding error message element
            $(errorElementId).text(fieldErrors[0]);
        }
    }
});

</script>
</body>
</html>
